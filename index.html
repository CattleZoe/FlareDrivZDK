<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlareDrive</title>
    <script src="https://unpkg.com/vue@3"></script>
    <style>
      ul {
        list-style: none;
        padding-left: 0;
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      .file-item {
        height: 48px;
        transition: background-color 0.2s ease-in-out;
      }

      .file-item:hover {
        background-color: #f5f5f5;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <form @submit="uploadFile">
        <input type="text" v-model="cwd" />
        <input type="file" id="file" name="file" />
        <button type="submit">Upload</button>
      </form>
      <ul>
        <li v-for="file in files">
          <a
            :href="`/drives/${bucket}/${cwd}${file.key}:/content`"
            target="_blank"
          >
            <div class="file-item" v-text="file.key"></div>
          </a>
        </li>
      </ul>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data: () => ({ bucket: "BUCKET", cwd: "", files: [] }),

        methods: {
          fetchFiles() {
            fetch(`/drives/${this.bucket}/${this.cwd}:/children`)
              .then((res) => res.json())
              .then((files) => {
                this.files = files.value;
              });
          },

          uploadFile(e) {
            e.preventDefault();
            if (!document.getElementById("file").value) return;

            if (!this.cwd.endsWith("/")) this.cwd += "/";

            var file = document.getElementById("file").files[0];
            fetch(`/drives/${this.bucket}/${this.cwd}${file.name}:/content`, {
              method: "PUT",
              body: file,
            })
              .then(async (response) => {
                if (response.ok) {
                  console.log(await response.json());
                } else {
                  console.log("Upload failed");
                }
              })
              .catch((error) => {
                console.log("Upload failed");
              });
          },
        },

        mounted() {
          this.fetchFiles();
        },
      }).mount("#app");
    </script>
  </body>
</html>
